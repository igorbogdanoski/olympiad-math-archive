---
import Layout from '../../layouts/Layout.astro';
import problems from '../../data/problems.json';
import katex from 'katex';

export async function getStaticPaths() {
  return problems.map((prob) => ({
    params: { id: prob.meta.problem_id || prob.filename.replace('.md', '') },
    props: { prob },
  }));
}

const { prob } = Astro.props;
const { meta, body, filename, grade, category, difficulty } = prob;

// –°–µ—Ä–≤–µ—Ä—Å–∫–æ —Ä–µ–Ω–¥–µ—Ä–∏—Ä–∞—ö–µ –Ω–∞ LaTeX
const renderMath = (text: string) => {
  if (!text) return "";
  let processed = text;
  
  // 1. Display Math $$ ... $$
  processed = processed.replace(/\$\$(.*?)\$\$/gs, (_, math) => {
    try {
      return katex.renderToString(math.trim(), { displayMode: true, throwOnError: false });
    } catch (e) { return math; }
  });

  // 2. Inline Math $ ... $
  processed = processed.replace(/\$(.*?)\$/g, (_, math) => {
    try {
      return katex.renderToString(math.trim(), { displayMode: false, throwOnError: false });
    } catch (e) { return math; }
  });

  return processed;
};

// –ü–æ–Ω–∞–ø—Ä–µ–¥–Ω–æ –ø–∞—Ä—Å–∏—Ä–∞—ö–µ –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–∞—ö–µ –Ω–∞ —Å–æ–¥—Ä–∂–∏–Ω–∞—Ç–∞
const formatContent = (text: string) => {
  if (!text) return "";
  
  let processed = renderMath(text);
  
  // 1. –¢—Ä–≥–Ω–∏ –≥–∏ –ø—Ä–µ–æ—Å—Ç–∞–Ω–∞—Ç–∏—Ç–µ –Ω–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–∏ –ª–∏–Ω–∫–æ–≤–∏
  processed = processed.replace(/\[‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –∫–æ–Ω –ò–Ω–¥–µ–∫—Å–æ—Ç\].*?(\n|<br>|$)/g, '');
  
  // 2. –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∏—Ä–∞—ò –≥–∏ "??? tip" –≤–æ —É–±–∞–≤–∏ –Ω–∞—Å–ª–æ–≤–∏ –∑–∞ —á–µ–∫–æ—Ä–∏
  // –û–≤–∞ –≥–∏ —Ñ–∞—ú–∞ —á–µ–∫–æ—Ä–∏—Ç–µ –≤–æ —Ä–µ—à–µ–Ω–∏–µ—Ç–æ
  processed = processed.replace(/\?\?\?\s+tip\s+"(.*?)"/g, '<div class="step-badge mt-8 mb-4">üîî $1</div>');
  
  // 3. –¢—Ä–≥–Ω–∏ –≥–∏ –µ–≤–µ–Ω—Ç—É–∞–ª–Ω–∏—Ç–µ –∑–∞–æ—Å—Ç–∞–Ω–∞—Ç–∏ –ø—Ä–∞—à–∞–ª–Ω–∏—Ü–∏ –∏ MKDocs –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∏
  processed = processed.replace(/\?\?\?/g, '');
  
  // 4. –¢—Ä–≥–Ω–∏ –≥–∏ –∑–∞–æ—Å—Ç–∞–Ω–∞—Ç–∏—Ç–µ –Ω–∞—Å–ª–æ–≤–∏ –Ω–∞ –∫—Ä–∞—ò–æ—Ç –∫–∞–∫–æ üèÅ –ó–∞–∫–ª—É—á–æ–∫
  processed = processed.replace(/(?:#|##)\s+üèÅ\s+–ó–∞–∫–ª—É—á–æ–∫.*/g, '');

  return processed;
};

// –û–±–∏–¥ –∑–∞ –ø–æ–¥–µ–ª–±–∞ –Ω–∞ —Å–µ–∫—Ü–∏–∏ –≤—Ä–∑ –æ—Å–Ω–æ–≤–∞ –Ω–∞ –Ω–∞—Å–ª–æ–≤–∏
const bodyContent = body.replace(/^#\s+.*\n/m, ''); // –¢—Ä–≥–Ω–∏ –≥–æ –≥–ª–∞–≤–Ω–∏–æ—Ç –Ω–∞—Å–ª–æ–≤ –∞–∫–æ –≥–æ –∏–º–∞

const solutionIndex = bodyContent.search(/(?:#|##)\s+.*–†–µ—à–µ–Ω–∏–µ/i);
const intuitionIndex = bodyContent.search(/(?:#|##|###)\s+.*(?:–ò–Ω—Ç—É–∏—Ü–∏—ò–∞|–ê–Ω–∞–ª–∏–∑–∞|–°–æ–≤–µ—Ç)/i);
const mentorIndex = bodyContent.search(/(?:#|##)\s+.*(?:–¢—É—Ç–æ—Ä–∏|–ù–∞—Å—Ç–∞–≤–Ω–∏—Ü–∏|–ù–∞–ø–æ–º–µ–Ω–∞)/i);

const sections = {
  title: filename.replace('.md', '').replace(/_/g, ' '),
  text: "",
  intuition: "",
  solution: "",
  mentor_notes: "",
  source: meta.source || ""
};

let contentEndForText = bodyContent.length;
if (intuitionIndex !== -1) contentEndForText = Math.min(contentEndForText, intuitionIndex);
if (solutionIndex !== -1) contentEndForText = Math.min(contentEndForText, solutionIndex);
if (mentorIndex !== -1) contentEndForText = Math.min(contentEndForText, mentorIndex);

sections.text = formatContent(bodyContent.substring(0, contentEndForText));

if (intuitionIndex !== -1) {
  let intuitionEnd = bodyContent.length;
  if (solutionIndex !== -1 && solutionIndex > intuitionIndex) intuitionEnd = Math.min(intuitionEnd, solutionIndex);
  if (mentorIndex !== -1 && mentorIndex > intuitionIndex) intuitionEnd = Math.min(intuitionEnd, mentorIndex);
  sections.intuition = formatContent(bodyContent.substring(intuitionIndex, intuitionEnd));
}

if (solutionIndex !== -1) {
  let solutionEnd = bodyContent.length;
  if (mentorIndex !== -1 && mentorIndex > solutionIndex) solutionEnd = Math.min(solutionEnd, mentorIndex);
  sections.solution = formatContent(bodyContent.substring(solutionIndex, solutionEnd));
}

if (mentorIndex !== -1) {
  sections.mentor_notes = formatContent(bodyContent.substring(mentorIndex));
}

// –ò—Å—á–∏—Å—Ç–∏ –≥–∏ –Ω–∞—Å–ª–æ–≤–∏—Ç–µ –æ–¥ —Å–∞–º–∏—Ç–µ —Å–µ–∫—Ü–∏–∏ –∑–∞ –ø–æ—É–±–∞–≤ –ø—Ä–∏–∫–∞–∑
sections.text = sections.text.replace(/^(?:#|##)\s+.*(?:–¢–µ–∫—Å—Ç|–ó–∞–¥–∞—á–∞).*\n/mi, '');
sections.intuition = sections.intuition.replace(/^(?:#|##|###)\s+.*(?:–ò–Ω—Ç—É–∏—Ü–∏—ò–∞|–ê–Ω–∞–ª–∏–∑–∞|–°–æ–≤–µ—Ç).*\n/mi, '');
sections.solution = sections.solution.replace(/^(?:#|##)\s+.*–†–µ—à–µ–Ω–∏–µ.*\n/mi, '');
sections.mentor_notes = sections.mentor_notes.replace(/^(?:#|##)\s+.*(?:–¢—É—Ç–æ—Ä–∏|–ù–∞—Å—Ç–∞–≤–Ω–∏—Ü–∏|–ù–∞–ø–æ–º–µ–Ω–∞).*\n/mi, '');

// –ü—Ä–µ—Å–º–µ—Ç–∫–∞ –Ω–∞ —Ç–µ–∂–∏–Ω–∞
const difficultyLevel = Math.round(difficulty / 2);
const difficultyColor = difficulty <= 3 ? 'bg-emerald-400' : difficulty <= 7 ? 'bg-amber-400' : 'bg-rose-500';

// –ù–∞–æ—ì–∞—ö–µ —Å–ª–∏—á–Ω–∏ –∑–∞–¥–∞—á–∏
const related = problems
    .filter(p => p.filename !== filename && (p.category === category || p.grade === grade))
    .sort(() => 0.5 - Math.random())
    .slice(0, 3);
---

<Layout title={`${sections.title} | –ú–∞—Ç–ê—Ä—Ö–∏–≤–∞`}>
  <div class="max-w-6xl mx-auto px-4 py-8">
    <!-- Breadcrumbs -->
    <nav class="flex mb-8 text-sm font-medium text-slate-500 gap-2 items-center no-print">
      <a href="/" class="hover:text-blue-600 transition-colors flex items-center gap-1">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
        –ê—Ä—Ö–∏–≤–∞
      </a>
      <svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 text-slate-300" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"/></svg>
      <span class="text-slate-900 dark:text-slate-100">{category}</span>
    </nav>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
      <!-- Main Content Area -->
      <div class="lg:col-span-2 space-y-8">
        <header class="mb-8">
          <div class="flex items-center gap-4 mb-4 no-print">
             <span class="px-3 py-1 bg-blue-100 dark:bg-blue-900/40 text-blue-700 dark:text-blue-300 text-xs font-bold rounded-full">
               {grade} –æ–¥–¥–µ–ª–µ–Ω–∏–µ
             </span>
             <span class="px-3 py-1 bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-400 text-xs font-bold rounded-full uppercase tracking-wider">
               {category}
             </span>
          </div>
          <h1 class="text-4xl md:text-5xl font-black text-slate-900 dark:text-white leading-tight mb-4">
            {sections.title}
          </h1>
          {sections.source && <p class="text-slate-500 italic">–ò–∑–≤–æ—Ä: {sections.source}</p>}
          
          <div class="hidden print-only mt-4 text-sm text-slate-400 border-t pt-4">
            –ê—Ä—Ö–∏–≤–∞: {category} | {grade} –æ–¥–¥–µ–ª–µ–Ω–∏–µ | {difficulty}/10 —Ç–µ–∂–∏–Ω–∞
          </div>
        </header>

        <!-- Problem Visualization -->
        {(meta.problem_id || filename) && (
          <div class="rounded-3xl overflow-hidden border border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-950 p-2 shadow-sm break-inside-avoid">
             <div class="bg-slate-50 dark:bg-slate-900 rounded-2xl p-6 flex justify-center">
                <img 
                    src={`/assets/images/${meta.problem_id || filename.replace('.md', '')}/${meta.problem_id || filename.replace('.md', '')}.png`} 
                    alt="–í–∏–∑—É–µ–ª–∏–∑–∞—Ü–∏—ò–∞"
                    class="max-w-full h-auto rounded-lg max-h-[400px] object-contain"
                    onerror="this.parentElement.parentElement.style.display='none'"
                  />
             </div>
          </div>
        )}

        <!-- Video Lesson -->
        {meta.video_url && (
          <section class="bg-slate-900 rounded-[2rem] overflow-hidden shadow-2xl no-print">
            <div class="px-8 py-4 bg-slate-800 border-b border-slate-700 flex items-center gap-3">
              <span class="flex h-3 w-3 rounded-full bg-red-500 animate-pulse"></span>
              <h3 class="text-white font-bold text-sm uppercase tracking-widest">–í–∏–¥–µ–æ –õ–µ–∫—Ü–∏—ò–∞</h3>
            </div>
            <div class="aspect-video">
              <video 
                src={meta.video_url} 
                controls 
                class="w-full h-full"
                poster={`/assets/images/${meta.problem_id || filename.replace('.md', '')}/${meta.problem_id || filename.replace('.md', '')}.png`}
              >
                –í–∞—à–∏–æ—Ç –ø—Ä–µ–ª–∏—Å—Ç—É–≤–∞—á –Ω–µ –ø–æ–¥–¥—Ä–∂—É–≤–∞ –≤–∏–¥–µ–æ.
              </video>
            </div>
          </section>
        )}

        <!-- Task Text -->
        <section class="bg-white dark:bg-slate-900 rounded-[2rem] border border-slate-200 dark:border-slate-800 shadow-sm overflow-hidden break-inside-avoid">
          <div class="px-8 py-6 border-b border-slate-100 dark:border-slate-800 bg-slate-50/50 dark:bg-slate-800/30 flex items-center justify-between no-print">
            <h2 class="text-xl font-bold flex items-center gap-3 text-slate-900 dark:text-white">
              <span class="p-2 bg-blue-600 text-white rounded-lg">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><line x1="10" y1="9" x2="8" y2="9"/></svg>
              </span>
              –¢–µ–∫—Å—Ç –Ω–∞ –∑–∞–¥–∞—á–∞—Ç–∞
            </h2>
            <button id="copy-text" class="text-slate-400 hover:text-blue-600 transition-colors p-2 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800" title="–ö–æ–ø–∏—Ä–∞—ò —Ç–µ–∫—Å—Ç">
              <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
            </button>
          </div>
          <div class="print-only hidden px-8 py-4 border-b border-slate-100 font-bold text-lg">–ó–∞–¥–∞—á–∞:</div>
          <div id="problem-body" class="p-8 prose prose-slate dark:prose-invert prose-lg max-w-none content-math italic text-slate-800 dark:text-slate-200" set:html={sections.text}>
          </div>
        </section>

        <!-- Expert Intuition / Analysis -->
        {sections.intuition && (
          <section class="bg-amber-50/50 dark:bg-amber-900/10 rounded-[2rem] border border-amber-100 dark:border-amber-900/30 overflow-hidden break-inside-avoid">
            <div class="px-8 py-6 border-b border-amber-100 dark:border-amber-900/30 flex items-center gap-3">
              <span class="text-2xl">üß†</span>
              <h2 class="text-xl font-bold text-amber-900 dark:text-amber-400">–ï–∫—Å–ø–µ—Ä—Ç—Å–∫–∞ –ê–Ω–∞–ª–∏–∑–∞ & –ò–Ω—Ç—É–∏—Ü–∏—ò–∞</h2>
            </div>
            <div class="p-8 prose prose-slate dark:prose-invert prose-lg max-w-none text-slate-700 dark:text-slate-300" set:html={sections.intuition}>
            </div>
          </section>
        )}

        <!-- Solution -->
        <section class="bg-white dark:bg-slate-900 rounded-[2rem] border border-slate-200 dark:border-slate-800 shadow-sm overflow-hidden break-inside-avoid">
           <div class="px-8 py-6 border-b border-slate-100 dark:border-slate-800 bg-slate-50/50 dark:bg-slate-800/30 no-print">
            <div class="flex items-center justify-between">
              <h2 class="text-xl font-bold flex items-center gap-3 text-slate-900 dark:text-white">
                <span class="p-2 bg-emerald-600 text-white rounded-lg">
                  <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
                </span>
                –†–µ—à–µ–Ω–∏–µ
              </h2>
              <button id="toggle-solution" class="text-sm font-bold text-blue-600 hover:underline">–ü—Ä–∏–∫–∞–∂–∏ —Ä–µ—à–µ–Ω–∏–µ</button>
            </div>
          </div>
          <div class="print-only hidden px-8 py-4 border-b border-slate-100 font-bold text-lg">–†–µ—à–µ–Ω–∏–µ:</div>
          <div id="solution-content" class="p-8 prose prose-slate dark:prose-invert prose-lg max-w-none content-math hidden print:block">
            {sections.solution ? (
              <div set:html={sections.solution}></div>
            ) : (
              <p class="text-slate-500 italic">–†–µ—à–µ–Ω–∏–µ—Ç–æ –∑–∞ –æ–≤–∞–∞ –∑–∞–¥–∞—á–∞ –µ –≤–æ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞...</p>
            )}
          </div>
        </section>

        <!-- Mentor Notes -->
        {sections.mentor_notes && (
          <section class="bg-indigo-50/50 dark:bg-indigo-900/10 rounded-[2rem] border border-indigo-100 dark:border-indigo-900/30 overflow-hidden break-inside-avoid">
            <div class="px-8 py-6 border-b border-indigo-100 dark:border-indigo-900/30 flex items-center gap-3">
              <span class="p-2 bg-indigo-600 text-white rounded-lg">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>
              </span>
              <h2 class="text-xl font-bold text-indigo-900 dark:text-indigo-400">–ú–µ—Ç–æ–¥–∏—á–∫–∏ –Ω–∞—Å–æ–∫–∏ –∑–∞ –Ω–∞—Å—Ç–∞–≤–Ω–∏—Ü–∏</h2>
            </div>
            <div class="p-8 prose prose-indigo dark:prose-invert prose-lg max-w-none text-slate-700 dark:text-slate-300 italic" set:html={sections.mentor_notes}>
            </div>
          </section>
        )}
      </div>

      <!-- Sidebar -->
      <aside class="space-y-8 no-print">
        <!-- Task Meta Card -->
        <div class="bg-white dark:bg-slate-900 rounded-3xl border border-slate-200 dark:border-slate-800 p-8 sticky top-8">
          <h3 class="text-lg font-bold mb-6 text-slate-900 dark:text-white">–î–µ—Ç–∞–ª–∏ –∑–∞ –∑–∞–¥–∞—á–∞—Ç–∞</h3>
          
          <div class="space-y-6">
            <div class="flex justify-between items-center">
              <span class="text-slate-500 text-sm">–¢–µ–∂–∏–Ω–∞</span>
              <div class="flex gap-1">
                {[...Array(5)].map((_, i) => (
                  <div class={`w-3 h-3 rounded-full ${i < difficultyLevel ? difficultyColor : 'bg-slate-200 dark:bg-slate-800'}`}></div>
                ))}
              </div>
            </div>

            <div class="flex justify-between items-center">
              <span class="text-slate-500 text-sm">–ö–∞—Ç–µ–≥–æ—Ä–∏—ò–∞</span>
              <span class="text-sm font-bold text-slate-900 dark:text-slate-100 uppercase">{category}</span>
            </div>

            <div class="flex justify-between items-center">
              <span class="text-slate-500 text-sm">–û–¥–¥–µ–ª–µ–Ω–∏–µ</span>
              <span class="text-sm font-bold text-slate-900 dark:text-slate-100">{grade}</span>
            </div>

            <div class="pt-6 border-t border-slate-100 dark:border-slate-800">
              <h4 class="text-xs font-black text-slate-400 uppercase tracking-widest mb-4">–í–µ—à—Ç–∏–Ω–∏</h4>
              <div class="flex flex-wrap gap-2">
                {meta.related_skills && meta.related_skills.length > 0 ? (
                  meta.related_skills.map((skill: string) => (
                    <span class="px-2 py-1 bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 text-[10px] font-bold rounded uppercase border border-blue-100 dark:border-blue-900/30">
                      {skill.replace(/_/g, ' ')}
                    </span>
                  ))
                ) : (
                  <span class="text-slate-400 text-xs italic">–ù–µ–º–∞ –Ω–∞–≤–µ–¥–µ–Ω–∏ –≤–µ—à—Ç–∏–Ω–∏</span>
                )}
              </div>
            </div>

            <div class="pt-6 grid grid-cols-2 gap-3">
               <button id="share-btn" class="py-3 bg-slate-100 dark:bg-slate-800 text-slate-700 dark:text-slate-200 rounded-xl font-bold flex items-center justify-center gap-2 hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg>
                –°–ø–æ–¥–µ–ª–∏
               </button>
               <button id="print-page" class="py-3 bg-blue-600 text-white rounded-xl font-bold flex items-center justify-center gap-2 hover:bg-blue-700 transition-colors shadow-lg shadow-blue-500/20">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect x="6" y="14" width="12" height="8"/></svg>
                –ü–µ—á–∞—Ç–∏
               </button>
            </div>
          </div>
        </div>

        <!-- Related Tasks -->
        {related.length > 0 && (
          <div class="space-y-4">
            <h3 class="text-lg font-bold text-slate-900 dark:text-white px-2">–°–ª–∏—á–Ω–∏ –∑–∞–¥–∞—á–∏</h3>
            <div class="space-y-3">
              {related.map(p => (
                <a href={`/tasks/${p.meta.problem_id || p.filename.replace('.md', '')}`} class="block p-4 bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 rounded-2xl hover:border-blue-500 dark:hover:border-blue-500 transition-colors group">
                  <div class="flex items-center gap-2 mb-1">
                    <span class="text-[9px] font-black text-blue-600 uppercase">{p.category}</span>
                    <span class="w-1 h-1 bg-slate-300 rounded-full"></span>
                    <span class="text-[9px] font-black text-slate-400 uppercase">{p.grade} –æ–¥–¥.</span>
                  </div>
                  <h4 class="font-bold text-sm text-slate-800 dark:text-slate-200 group-hover:text-blue-600 transition-colors line-clamp-2">
                    {p.filename.replace('.md', '').replace(/_/g, ' ')}
                  </h4>
                </a>
              ))}
            </div>
          </div>
        )}
      </aside>
    </div>
  </div>
</Layout>

<script>
  const toggleBtn = document.getElementById('toggle-solution');
  const solutionContent = document.getElementById('solution-content');
  
  if (toggleBtn && solutionContent) {
    toggleBtn.addEventListener('click', () => {
      const isHidden = solutionContent.classList.contains('hidden');
      if (isHidden) {
        solutionContent.classList.remove('hidden');
        toggleBtn.textContent = '–°–∫—Ä–∏—ò —Ä–µ—à–µ–Ω–∏–µ';
      } else {
        solutionContent.classList.add('hidden');
        toggleBtn.textContent = '–ü—Ä–∏–∫–∞–∂–∏ —Ä–µ—à–µ–Ω–∏–µ';
      }
    });
  }

  const printBtn = document.getElementById('print-page');
  if (printBtn) {
    printBtn.addEventListener('click', () => {
      window.print();
    });
  }

  const copyBtn = document.getElementById('copy-text');
  if (copyBtn) {
    copyBtn.addEventListener('click', () => {
      const body = document.getElementById('problem-body');
      if (body) {
        navigator.clipboard.writeText(body.innerText).then(() => {
          const originalSvg = copyBtn.innerHTML;
          copyBtn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-emerald-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>';
          setTimeout(() => {
            copyBtn.innerHTML = originalSvg;
          }, 2000);
        });
      }
    });
  }

  const shareBtn = document.getElementById('share-btn');
  if (shareBtn) {
    shareBtn.addEventListener('click', () => {
      if (navigator.share) {
        navigator.share({
          title: document.title,
          url: window.location.href
        });
      } else {
        navigator.clipboard.writeText(window.location.href);
        alert('–õ–∏–Ω–∫–æ—Ç –µ –∫–æ–ø–∏—Ä–∞–Ω –≤–æ –º–µ–º–æ—Ä–∏—ò–∞—Ç–∞!');
      }
    });
  }
</script>

<style is:global>
  .content-math .katex-display {
    @apply my-8 overflow-x-auto overflow-y-hidden py-4 bg-slate-50 dark:bg-slate-800/50 rounded-2xl;
  }
  .content-math .katex {
    @apply text-lg md:text-xl;
  }
  .step-badge {
    @apply inline-block px-4 py-2 bg-blue-50 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 font-black text-sm rounded-xl border border-blue-100 dark:border-blue-800 shadow-sm uppercase tracking-wider;
  }
  .prose blockquote {
    @apply border-l-4 border-blue-500 bg-blue-50 dark:bg-blue-900/20 px-6 py-4 rounded-r-xl not-italic my-6;
  }
  .prose p {
    @apply mb-4 leading-relaxed;
  }
  .prose ul {
    @apply list-disc list-inside mb-4 space-y-2;
  }
  .prose ol {
    @apply list-decimal list-inside mb-4 space-y-2;
  }
  .prose h3 {
    @apply text-xl font-bold mt-8 mb-4 text-slate-900 dark:text-white;
  }
  .prose h4 {
    @apply text-lg font-bold mt-6 mb-3 text-slate-800 dark:text-slate-200;
  }
  .prose strong {
    @apply font-bold text-slate-900 dark:text-white;
  }
</style>

